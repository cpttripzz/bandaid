{% extends '::base.html.twig' %}



{% block stylesheets %}
    {{ parent() }}
    {{ form_stylesheet(edit_form) }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ form_javascript(edit_form) }}
{% endblock %}
{% block container %}
    {% include 'ZEBABundle::show_new_location_modal.html.twig' %}
    <button class="btn btn-primary fa fa-globe" id="btnShowNewLocation" data-target="#largeModal"> Add New Address
    </button>
    <ul class="nav nav-pills">
        <li class="active"><a href="#tabBandsMain" data-toggle="pill">General</a></li>
        <li><a href="#tabBandsVacancies" data-toggle="pill">Band Vacancies</a></li>
        <li><a href="#tabBandsMedia" data-toggle="pill">Media</a></li>
    </ul>
    {{ form_start(edit_form) }}
    <div class="tab-content" id="tab-content">
        <div class="tab-pane" id="tabBandsMedia"
             data-prototype="{{ form_widget(edit_form.documents.vars.prototype)|e }}">
            {{ form_row(edit_form.documents) }}
        </div>
        <div class="tab-pane active" id="tabBandsMain">
            <h4>Band Details</h4>
            {{ form_row(edit_form.name) }}
            {{ form_row(edit_form.description) }}
            {{ form_row(edit_form.genres) }}
            {{ form_row(edit_form.musicians) }}
            {{ form_row(edit_form.addresses) }}
        </div>
        <div class="tab-pane " id="tabBandsVacancies">

            <div id="panelBandVacancies" class="panel"
                 data-prototype="{{ form_widget(edit_form.bandVacancyAssociations.vars.prototype)|e }}">
                <h4>Band Vacancies</h4>
                {% for bandVacancyAssociation in edit_form.bandVacancyAssociations %}
                    <div class="panel-group">
                        <div class="panel panel-default" id="panel{{ bandVacancyAssociation.vars.data.id }}">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse"
                                       data-target="#collapse{{ bandVacancyAssociation.vars.data.id }}"
                                       href="#collapse{{ bandVacancyAssociation.vars.data.id }}">
                                        {{ bandVacancyAssociation.vars.data.bandVacancy.name }}
                                    </a>
                                </h4>
                            </div>
                            <div data-id="{{ bandVacancyAssociation.vars.data.id }}"
                                 id="collapse{{ bandVacancyAssociation.vars.data.id }}"
                                 class="panel-collapse collapse in">
                                <div class="panel-body" id="panel-body{{ bandVacancyAssociation.vars.data.id }}">
                                    <div>
                                        {{ form_row(bandVacancyAssociation.bandVacancy.name) }}

                                        {{ form_row(bandVacancyAssociation.bandVacancy.comment) }}
                                        {% for genre in bandVacancyAssociation.bandVacancy.genres %}
                                            {{ form_row(genre) }}
                                        {% endfor %}
                                        {% for instrument in bandVacancyAssociation.bandVacancy.instruments %}
                                            {{ form_row(instrument) }}
                                        {% endfor %}

                                    </div>
                                </div>
                                <button class="btn btn-danger fa fa-trash-o"
                                        id="deleteBandVacancyAssociation{{ bandVacancyAssociation.vars.data.id }}">
                                    Delete
                                    Vacancy
                                </button>
                            </div>
                        </div>

                    </div>

                {% endfor %}

            </div>
            {% include 'ZEBABundle::show_new_band_vacancy_modal.html.twig' %}
        </div>

        {{ form_end(edit_form) }}

    </div><!-- tab content -->


    <script type="application/javascript">

        function addForm($collectionHolder, $elementToPrepend) {
            // Get the data-prototype explained earlier
            var prototype = $collectionHolder.data('prototype');
            // get the new index
            var index = $collectionHolder.data('index');

            // Replace '__name__' in the prototype's HTML to
            // instead be a number based on how many items we have
            var newForm = prototype.replace(/__name__/g, index);

            $("#" + $elementToPrepend).prepend(newForm);

        }
        jQuery(document).ready(function () {
            var counter = -1;
            {% for bandVacancyAssociation in edit_form.bandVacancyAssociations %}
            counter++;
            $("#ze_babundle_band_bandVacancyAssociations_" + counter + "_bandVacancy")
                    .appendTo($('#panel-body{{ bandVacancyAssociation.vars.data.id }}'));
            {% endfor %}
            var bandVacanciesHolder;
            // setup an "add a tag" link
            var addNewBandVacancy = $('<button href="#modalShowNewBandVacancy" data-toggle="modal"  class="btn btn-primary fa fa-plus-circle" id="btnShowNewBandVacancy" > Add New Vacancy</button>');
            var $newLinkLi = $('#panelBandVacancies').append(addNewBandVacancy);
            $('#tab-content').append('<br/><button type="submit" class="btn btn-primary"><span class="fa fa-floppy-o"></span> Submit Changes</button>');
            bandVacanciesHolder = $('#panelBandVacancies');
            bandVacanciesHolder.append($newLinkLi);
            bandVacanciesHolder.data('index', bandVacanciesHolder.find(':input').length);

            addNewBandVacancy.on('click', function (e) {
                e.preventDefault();
                addForm(bandVacanciesHolder, 'divShowNewBandVacancy');
            });


            var bandMediaHolder;
            var addNewBandMedia = $('<button class="btn btn-primary fa fa-plus-circle" id="btnShowNewDocument" > Add New Document</button>');
            var newBandMediaButton = $('#tabBandsMedia').append(addNewBandMedia);

            bandMediaHolder = $('#tabBandsMedia');
            bandMediaHolder.append(newBandMediaButton);
            bandMediaHolder.data('index', bandVacanciesHolder.find(':input').length);

            addNewBandMedia.on('click', function (e) {
                e.preventDefault();
                addForm(bandMediaHolder, 'tabBandsMedia');
            });

            $(document).on("click", 'button[id^="deleteBandVacancyAssociation"]', function (e) {
                $(this).parent().parent().remove();
            });
            $("#ze_babundle_band_submit").hide();
            $("#btnShowNewLocation").appendTo($("#s2id_ze_babundle_band_addresses"));

        });
    </script>
{% endblock %}